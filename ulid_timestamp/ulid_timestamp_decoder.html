<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ULID Timestamp Decoder</title>
  <style>
    :root{font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;line-height:1.4}
    body{display:flex;min-height:100vh;align-items:center;justify-content:center;background:#0f172a;color:#e6eef8;padding:24px}
    .card{background:linear-gradient(180deg,#0b1220, #071029);padding:28px;border-radius:12px;box-shadow:0 6px 24px rgba(2,6,23,.6);width:720px;max-width:100%}
    h1{margin:0 0 8px;font-size:20px}
    p.lead{margin:0 0 18px;color:#a6b8d9}
    label{display:block;font-size:13px;margin-bottom:6px}
    input[type=text]{width:100%;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit;font-size:15px}
    .row{display:flex;gap:10px;margin-top:12px}
    button{background:#0ea5a5;border:none;padding:10px 14px;border-radius:8px;color:#021019;font-weight:600;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#aee7ff}
    .out{margin-top:16px;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03)}
    .field{display:flex;justify-content:space-between;gap:12px;align-items:center;padding:8px 0;border-bottom:1px dashed rgba(255,255,255,0.02)}
    .field:last-child{border-bottom:0}
    .label{color:#9fb7d6;font-size:13px}
    .value{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;font-size:13px;color:#e6f7ff}
    .muted{color:#86a6c4;font-size:13px}
    footer{margin-top:14px;color:#7f9db8;font-size:12px}
    .note{margin-top:8px;color:#7b9cc0;font-size:13px}
    .sample{margin-top:10px;color:#dff7ff;background:rgba(14,165,165,0.04);padding:8px;border-radius:6px;font-family:ui-monospace,monospace}
  </style>
</head>
<body>
  <main class="card" role="main">
    <h1>ULID timestamp decoder</h1>
    <p class="lead">Paste a ULID and this page will decode the embedded creation timestamp (milliseconds since Unix epoch) and show human-friendly dates.</p>

    <label for="ulid">ULID</label>
    <input id="ulid" type="text" placeholder="01F8MECHZX3TBDSZ7XRADM79XV" spellcheck="false" autocomplete="off" />

    <div class="row">
      <button id="decode">Decode</button>
      <button id="paste" class="secondary">Paste & Decode</button>
      <button id="sample" class="secondary">Use Sample</button>
      <button id="clear" class="secondary">Clear</button>
    </div>

    <div class="out" id="output" aria-live="polite">
      <div class="field"><div class="label">Timestamp (ms)</div><div class="value" id="ts">—</div></div>
      <div class="field"><div class="label">ISO (UTC)</div><div class="value" id="iso">—</div></div>
      <div class="field"><div class="label">Local</div><div class="value" id="local">—</div></div>
      <div class="field"><div class="label">JS Date</div><div class="value" id="jsdate">—</div></div>
      <div class="field"><div class="label">Notes</div><div class="muted" id="notes">The first 10 characters of a ULID encode a 48-bit millisecond timestamp (Crockford base32).</div></div>
    </div>

    <div class="note">Works with uppercase or lowercase ULIDs. Will accept the standard 26-character ULID but only the timestamp portion (first 10 chars) is required.</div>

    <div class="sample" id="sampleBox">Sample ULID: <strong id="sampleVal">01F8MECHZX3TBDSZ7XRADM79XV</strong></div>

    <footer>Want a downloadable version or extra features (copy to clipboard, parse many ULIDs)? Tell me and I’ll add them.</footer>
  </main>

  <script>
    // Crockford base32 alphabet used by ULID
    const ALPHABET = '0123456789ABCDEFGHJKMNPQRSTVWXYZ';
    const MAP = {};
    for (let i = 0; i < ALPHABET.length; i++) MAP[ALPHABET[i]] = i;

    function normalizeInput(s){
      if (!s) return '';
      s = s.trim();
      // allow lower/upper case
      s = s.toUpperCase();
      // remove any surrounding whitespace
      return s;
    }

    function decodeTimestampFromUlid(ulid){
      if (!ulid) throw new Error('Empty ULID');
      const u = normalizeInput(ulid);
      if (u.length < 10) throw new Error('ULID must be at least 10 characters long to contain a timestamp.');
      const tchars = u.slice(0, 10);
      // parse as BigInt in base32 (Crockford)
      let ts = 0n;
      for (const ch of tchars){
        if (!(ch in MAP)) throw new Error('Invalid character in ULID timestamp: ' + ch);
        ts = ts * 32n + BigInt(MAP[ch]);
      }
      // ts is milliseconds since UNIX epoch as BigInt
      return ts;
    }

    function showResult(ulid){
      const outTs = document.getElementById('ts');
      const outISO = document.getElementById('iso');
      const outLocal = document.getElementById('local');
      const outJs = document.getElementById('jsdate');
      const notes = document.getElementById('notes');

      try {
        const tsBig = decodeTimestampFromUlid(ulid);
        // convert to Number when safe
        let tsNum;
        if (tsBig <= BigInt(Number.MAX_SAFE_INTEGER)) tsNum = Number(tsBig);
        else throw new Error('Timestamp too large to convert to Number safely.');

        const d = new Date(tsNum);
        outTs.textContent = tsBig.toString();
        outISO.textContent = d.toISOString();
        outLocal.textContent = d.toString();
        outJs.textContent = `new Date(${tsBig}n) -> ${d.toString()}`;
        notes.textContent = 'Decoded successfully from the first 10 characters (Crockford base32).';
      } catch (err){
        outTs.textContent = '—';
        outISO.textContent = '—';
        outLocal.textContent = '—';
        outJs.textContent = '—';
        notes.textContent = err.message;
      }
    }

    document.getElementById('decode').addEventListener('click', ()=>{
      const val = document.getElementById('ulid').value;
      showResult(val);
    });

    document.getElementById('sample').addEventListener('click', ()=>{
      const sample = document.getElementById('sampleVal').textContent;
      document.getElementById('ulid').value = sample;
      showResult(sample);
    });

    document.getElementById('clear').addEventListener('click', ()=>{
      document.getElementById('ulid').value = '';
      showResult('');
    });

    document.getElementById('paste').addEventListener('click', async ()=>{
      try {
        const text = await navigator.clipboard.readText();
        document.getElementById('ulid').value = text || '';
        showResult(text || '');
      } catch (e){
        alert('Failed to read clipboard: ' + (e && e.message));
      }
    });

    // initial sample on load
    document.addEventListener('DOMContentLoaded', ()=>{
      const sample = document.getElementById('sampleVal').textContent;
      document.getElementById('ulid').value = sample;
      showResult(sample);
    });
  </script>
</body>
</html>
